# Mass Shootings Tracker

The Mass Shootings Tracker is a Dashboard of mass shootings incidents occurred in the United States.
The application was developed using Python 3 and Dash, with dynamic charts generated by Plotly.

The user can view the shooting incidents in the interactive map, or in graphs displaying incidents by day, by month, or by state.


![Responsive Mockup](https://mass-shootings-us.herokuapp.com/mass-shootings/assets/images/responsive.png)

## Project Goals

The goal of this project is to deliver an application capable of manipulating a dataset and extract information and to provide insights about the information contained in the data. 

## Target Audience

This web app is targeted to anyone interested in tracking, or studying the phenomenon of mass shootings occurred in the US.

## Features

The Mass Shooting Tracker is divided into 3 sections:
1. The header containing the title and the navigation links:
   - Locations
   - By Day
   - By Month
   - By State.
2. The main content area where the graphs are displayed. 
3. A Footer with a link to the dash / plotly website.

### Existing Features

- __The Header__ 
  - The Header contains a title and the Navbar with the links for each tab of the dashboard. 
 
![Header](https://mass-shootings-us.herokuapp.com/mass-shootings/assets/images/header.png)

- __Locations Tab__
  - The locations tab contains an interactive map of the locations of each mass shooting incident. 
    - The user can hover over each dot to display more information about the incident such as location name, number of fatal victims and number of total victims.

![Locations](https://mass-shootings-us.herokuapp.com/mass-shootings/assets/images/locations.png)


- __By Day Tab__
  - This tab displays a scatter plot of the number of the shootings incidents vs day.
  - Most of the datapoints are at the base of the plot (as in 1 shooting per day), however, in some cases we can see as much as 7 mass shootings in a single day.

![By Day](https://mass-shootings-us.herokuapp.com/mass-shootings/assets/images/day.png)

- __By Month Tab__
  - This tab displays a bar plot of shootings by month of occurrence.
  - From this plot we can see that June, July and August are the months with highest number of incidents. This is supporting evidence to a theory that hot weather is linked to increase in violent behaviour.

![By Month](https://mass-shootings-us.herokuapp.com/mass-shootings/assets/images/month.png)

- __By State Tab__
  - This tab displays a horiozontal bar plot of shootings divided by state.
  - As it would be expected, the number of mass shooting incidents are strongly correlated with the state population.

![By State](https://mass-shootings-us.herokuapp.com/mass-shootings/assets/images/state.png)

- __List Tab__
  - This tab is divided into 2 sections:
    - A form to input new mass shooting incidents.
    - A list of the mass shooting incidents currently in the dataset.
  
    __The Form__
    - The user input is validated before being recorded into the dataset.
        - All fields are required.
        - Date must be between 01/01/1900 and the current date. 
        - The address is used to fetch latitude and longitude using Nominatim tool from Geopy library in order to plot the incident on the map.
        - Number of injured and killed must be non-negative integers.

    ![Form](https://mass-shootings-us.herokuapp.com/mass-shootings/assets/images/form.png)

    __The List__
    - The list is sorted in descending order by date, meaning the first item on the list is the most recent incident. 
    - Each row contains a button to delete the row, if necessary. 

    ![Form](https://mass-shootings-us.herokuapp.com/mass-shootings/assets/images/list.png)


- __The Footer__
  - The footer only contains a link to the dash / plotly website.

![Form](https://mass-shootings-us.herokuapp.com/mass-shootings/assets/images/footer.png)


### Features Left to Implement
- A password protected admin area so only authenticated users can insert or delete records.
- An edit page in order to change row contents. 
- An improved user interface with more attractive design would be very beneficial to the user experience. 

## Technologies

- Python 3
  - [Plotly](https://plotly.com/) for interactive map and charts. 
  - [Dash](https://dash.plotly.com/) for generating the Flask web application.
  - [Dash Bootstrap Components](https://dash-bootstrap-components.opensource.faculty.ai/) for UI elements. 
  - [Bootstrap](https://getbootstrap.com/) for styling and formatting the application. 
  - [Pandas](https://pandas.pydata.org/) for importing, exporting and manipulating the dataset.

- IDE - Visual Studio Code
  - The app was developed using the latest version of Visual Studio Code (1.70.2).
- Git 
  - Used to backup and document the development process.
- GitHub
  - The source code is hosted on GitHub and deployed using Heroku.

## Testing

The app was tested both on Google Chrome and Safari. 


### Functional Testing

_Scenario 1 - Correct input_
  1. Navigate to [Mass Shootings US](https://mass-shootings-us.herokuapp.com/).
  2. Click on the "List" tab:
  3. Select a date from the date picker.
  4. Enter the following information on the form:
     -Address: Madison Square Garden
     -Injured: 5
     -Killed: 3
  5. Click the button to save.
  
Expected:
1. The incident should be recorded on the dataset, the list of incidents below should be upodated to reflect the changes. 

Actual: the app behaves as expected. The incident is recorded on the dataset and the table containing the incident list is updated automatically. 

A new shooting incident does not appear immediately on the map. This bug was detected recently and a fix was implemented using @app.callback(Output()). However, for reasons not yet established, when the map was being updated, its canvas was resized to 400px by 300px, regardless of the size of the actual plot area. This resulted in a very poor user experience that could only be solved by reloading the page.

This bug could not be fixed in time but it will be addressed in the future. A decision was made to remove the live update feature in order to improve user experience with the trade off of not having a live update feature. 

_Scenario 2 - Invalid Address_
1. Navigate to [Mass Shootings US](https://mass-shootings-us.herokuapp.com/).
2. Select a date from the date picker. 
3. Enter the following:
  - Address: Alameda Yaya 25
  - Injured: 10
  - Killed: 5
4. Click on the "Save" button. 

Expected:
1. The address is not in the United States, so the app rejects the input and warns the user the address must be a valid Google Maps address in the U.S.. 
2. The alert box is displayed after the button for 4 seconds with the message "Address must be in the United States.". 

Actual: the app behaves as expected with no warnings or erros displayed in the console. 

_Scenario 3 - Missing Injured or Killed_
1. Navigate to [Mass Shootings US](https://mass-shootings-us.herokuapp.com/).
2. Click on the "List" link. 
2. Select a date from the date picker.
3. Enter the following:
  - Address: Madison Square Garden
3. Click on the "Save" button.

Expected: 
1. The incident is not recorded.
2. The alert box is displayed for 4 seconds with the message "Injured and Killed are required and must be integers.". 

Actual: The app behaves as expected. There are no warnings or erros displayed in the console. 

_Scenario 4 - Value out of range_
1. Navigate to [Mass Shootings US](https://mass-shootings-us.herokuapp.com/).
2. Click on the "List" link. 
2. Select a date from the date picker.
3. Enter the following:
  - Address: Madison Square Garden
  - Injured: -1
  - Killed: 3
3. Click on the "Save" button.

Expected: 
1. The incident is not recorded.
2. The alert box is displayed for 4 seconds with the message "Injured and Killed are required and must be non-negative integers.". 

Actual: The app behaves as expected. There are no warnings or erros displayed in the console. 

_Scenario 5 - Delete list item_
1. Navigate to [Mass Shootings US](https://mass-shootings-us.herokuapp.com/).
2. Click on the "List" link.
3. Click on the "X" button in one of the rows on the list.

Expected:
1. The incident should be removed from the list.
   
Actual: the app behaves as expected. There are no warnings or erros displayed in the console.

### Validator Testing

- Python code validation was performed by [CI Python Linter](https://pep8ci.herokuapp.com/#)

 ![Python Validation](https://mass-shootings-us.herokuapp.com/mass-shootings/assets/images/python_validation.png)


- HTML
  - No errors found when passing through the official [W3C Validator](https://validator.w3.org/).
  - One warning was issued for the "inputmode" attribute which is not supported by all browsers. This attribute was included to force mobile devices to display the numeric keypad when the Value text field is selected.
 ![HTML Validation](https://mass-shootings-us.herokuapp.com/mass-shootings/assets/images/html_validation.png)

- CSS
  - bootstrap.min.css: 16 parse errors were found when passing through [Jigsaw Validator](https://jigsaw.w3.org/). These errors were all flagged at the bootstrap.min.css. It was not possible to establish the cause of these errors in time. 

  - style.css:
    ![Jigsaw style.css](https://mass-shootings-us.herokuapp.com/mass-shootings/assets/images/css_validation.png)


### Bugs Fixed
- An unnamed column was being created everytime the shootings.csv file was read into a pandas dataframe. The column was also being generated when passing from pandas dataframe to the dash datatable. 
A solution was to create a funciton to remove this column if present, and return the dataframe without it.

### Unfixed Bugs
- There form is losing the information when there is an invalid entry. This is being caused by one of the @app.callbacks(), however I could not find a solution for this yet. 

- Map being resized to 400px by 300px when live update feature is enabled. Feature is disabled at the moment to prevent this undesirable behaviour. 

## Deployment

### Version Control

The web app was created using Virtual Studio Code IDE and pushed to the remote repository 'mass-shootings'. 

The following git commands were used throughout the development of the app:

```git add .``` - This command was used to add all the files to the staging area before they are committed.

```git commit -m "commit message"``` - This command was used to commit changes to the local repository. 

```git push``` - This command was used to push the commits to the remote repository on GitHub. 

```git push heroku main``` - This command was used push changes to the Heroku platform and build the application online. 

### Deployment to Heroku
  - The site was deployed to Heroku using the steps as follows:
    - A new application was created using heroku portal (heroku account is required).
    - The heroku command line was installed locally using the command ```brew tap heroku/brew && brew install heroku```
    - From the menu on left select 'New > Create New App'.
    - Type a name for the app. 
    - Click 'Create app'.
    - Go to Settings
    - Add a Config Var as follows:
     - Key: PORT
     - Value: 8000
    - Click on "Deploy".
    - Select "Heroku GIT" and follow the instruction on screen. 
    - A few changes on local files were needed in order to install the libraries and run the application correctly:
     - ```Procfile``` was changed to contain the following:
      ```web: gunicorn run:server```

     - a virtual environment was created using the commands:
     ```
        python3 -m pip install --user virtualenv
        python3 -m venv env
        source env/bin/activate
     ```

     - With the virtual environment activated, the next step is to install all the necessary libraries using pip. 

     ```pip install pandas dash dash_bootstrap_components plotly geopy gunicorn numpy pyarrow```
     - After all libraries are installed, we update our requirements.txt file using the command:
     ```pip freeze > requirements.txt```

     - To create the Heroku app: via command line
     ```
        heroku create -a mass-shootings-us
        git remote -v
     ```

     - To deploy the app, run the command
     ```git push heroku main```

### Clone the Repository Code Locally
1. Navigate to the [Mass Shootings Repository](https://github.com/alexandrearantes1/mass-shootings).
2. Click on the code drop down button
3. Click on HTTPS
4. Copy the repository link to the clipboard
5. Open your IDE of choice (git must be installed for the next steps)
6. Type git clone copied-git-url into the IDE terminal
7. The project will now of been cloned on your local machine for use.



## Credits

[Meet Plotly Mapbox. Best Choice for Geographic Data Visualization](https://towardsdatascience.com/meet-plotly-mapbox-best-choice-for-geographic-data-visualization-599b514bcd9a)

The original dataset containing records of gun violence from 01/2013 until 03/2018 can be found [here](https://www.kaggle.com/datasets/jameslko/gun-violence-data). 

Extensive research was made using official docs:
 - [plotly](https://plotly.com/)
 - [dash](https://dash.plotly.com/)
 - [dash bootstrap components](https://dash-bootstrap-components.opensource.faculty.ai/)
 - [Geopy](https://geopy.readthedocs.io/en/stable/)

 Compreheensive youtube tutorials and content on Dash can be found [here](https://www.youtube.com/@CharmingData).